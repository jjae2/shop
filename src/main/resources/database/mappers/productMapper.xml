<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.one.s1.product.ProductDAO">

 
  	<insert id="add" parameterType="ProductDTO">
	    INSERT INTO PRODUCT (PRODUCT_NUM, CATEGORY_NUM, ID, PRODUCT_NAME, PRODUCT_PRICE, CONTENT, SALES, STOCK, HIT, RATE)
	    VALUES (PRODUCT_SEQ.NEXTVAL, #{category_num}, #{id}, #{product_name}, #{product_price}, #{content}, 0, #{stock}, 0, #{rate})
 	</insert>
 	
 	<select id="detail" parameterType="ProductDTO" resultType="ProductDTO">
		SELECT * FROM PRODUCT WHERE PRODUCT_NUM = #{product_num}
 	</select>
 	
 	<update id="detailHit" parameterType="ProductDTO">
		UPDATE PRODUCT SET HIT = HIT+1 WHERE PRODUCT_NUM = #{product_num}
 	</update>
 	
 
 	<select id="list" parameterType="ProductDTO" resultType="ProductDTO">
  		SELECT * FROM
		    (SELECT rownum R, B.* FROM 
		        (SELECT * FROM PRODUCT WHERE 
		        	PRODUCT_NUM>0 
		        	and 
		        	<choose>
		        		<when test="kind=='col1'">
		        			PRODUCT_NAME
		        		</when>
		        		<when test="kind =='col2'">
		        			CONTENT
		        		</when>
		        		<otherwise>
		        			ID
		        		</otherwise>
		        	</choose>	
		        	LIKE '%'||#{search}||'%'
		            ORDER BY PRODUCT_NUM DESC
		         ) B
		     )
		WHERE R between #{startRow} and #{lastRow}
 	</select>
 	
 	 	<select id="sellList" parameterType="ProductDTO" resultType="ProductDTO">
  		SELECT * FROM
		    (SELECT rownum R, B.* FROM 
		        (SELECT * FROM PRODUCT WHERE 
		        	PRODUCT_NUM>0 
		        	and 
		        	<choose>
		        		<when test="kind=='col1'">
		        			PRODUCT_NAME
		        		</when>
		        		<when test="kind =='col2'">
		        			CONTENT
		        		</when>
		        		<otherwise>
		        			ID
		        		</otherwise>
		        	</choose>	
		        	LIKE '%'||#{search}||'%'
		            ORDER BY PRODUCT_NUM DESC
		            AND
		            ID = #{id}
		         ) B
		     )
		WHERE R between #{startRow} and #{lastRow}
 	</select>
 	
 	
	<select id="total" resultType="Long" parameterType="Pager">
 		SELECT COUNT(PRODUCT_NUM) FROM PRODUCT
 		WHERE
 			PRODUCT_NUM>0 
		    and 	       	
		     <choose>
		     	<when test="kind=='col1'">
		     		PRODUCT_NAME
		     	</when>
		     	<when test="kind =='col2'">
		     		CONTENT
		     	</when>
		     	<otherwise>
		     		ID
		     	</otherwise>
		     </choose>	
        	LIKE '%'||#{search}||'%' 
 	</select>
		
		<select id="total2" resultType="Long" parameterType="Pager">
 		SELECT COUNT(PRODUCT_NUM) FROM PRODUCT
 		WHERE
 			PRODUCT_NUM>0 
		    and 	       	
		     <choose>
		     	<when test="kind=='col1'">
		     		PRODUCT_NAME
		     	</when>
		     	<when test="kind =='col2'">
		     		CONTENT
		     	</when>
		     	<otherwise>
		     		ID
		     	</otherwise>
		     </choose>	
        	LIKE '%'||#{search}||'%' 
        	AND
        	ID = #{id}
 	</select>	
		
 	<update id="update" parameterType="ProductDTO">
 		UPDATE PRODUCT SET CATEGORY_NUM=#{category_num}, PRODUCT_NAME=#{product_name}, PRODUCT_PRICE=#{product_price}, CONTENT=#{content}, STOCK=#{stock}, RATE=#{rate} WHERE PRODUCT_NUM = #{product_num}
 	</update>

 	<delete id="delete" parameterType="ProductDTO">
 		DELETE PRODUCT WHERE PRODUCT_NUM=#{product_num}
 	</delete>


</mapper>